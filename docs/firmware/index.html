<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=sv class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=alternate type=application/rss+xml href=https://sthlm-mesh.se/docs/firmware/index.xml><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Custom Firmware | STHLM-MESH</title>
<meta name=description content="Binärer Varning Att ladda ner firmware från internet medför alltid en risk. Istället bör du själv genomföra kodändringarna nedan och kompilera firmware själv. ros-firmware-rak4631-2.6.11.60ec05e.uf2 ros-firmware-rak4631-ota-2.6.11.60ec05e.zip ros-firmware-rak4631-2.6.4.b89355f.uf2 ros-firmware-rak4631-ota-2.6.4.b89355f.zip ros-firmware-rak4631-2.5.21.447533a.uf2 nrf_erase2.uf2 Kodändringar Nedan är de ändringar jag gör på firmwaren för att det ska passa mig.
Channels.cpp - channelSettings.module_settings.position_precision = 13; // default to sending location on the primary channel + channelSettings.module_settings.position_precision = 32; // default to sending location on the primary channel NeighborInfoModule.cpp Tillåt sändning av Neighbor info över default kanalen."><meta property="og:url" content="https://sthlm-mesh.se/docs/firmware/"><meta property="og:site_name" content="STHLM-MESH"><meta property="og:title" content="Custom Firmware"><meta property="og:description" content="Binärer Varning Att ladda ner firmware från internet medför alltid en risk. Istället bör du själv genomföra kodändringarna nedan och kompilera firmware själv. ros-firmware-rak4631-2.6.11.60ec05e.uf2 ros-firmware-rak4631-ota-2.6.11.60ec05e.zip ros-firmware-rak4631-2.6.4.b89355f.uf2 ros-firmware-rak4631-ota-2.6.4.b89355f.zip ros-firmware-rak4631-2.5.21.447533a.uf2 nrf_erase2.uf2 Kodändringar Nedan är de ändringar jag gör på firmwaren för att det ska passa mig.
Channels.cpp - channelSettings.module_settings.position_precision = 13; // default to sending location on the primary channel + channelSettings.module_settings.position_precision = 32; // default to sending location on the primary channel NeighborInfoModule.cpp Tillåt sändning av Neighbor info över default kanalen."><meta property="og:locale" content="sv"><meta property="og:type" content="website"><meta itemprop=name content="Custom Firmware"><meta itemprop=description content="Binärer Varning Att ladda ner firmware från internet medför alltid en risk. Istället bör du själv genomföra kodändringarna nedan och kompilera firmware själv. ros-firmware-rak4631-2.6.11.60ec05e.uf2 ros-firmware-rak4631-ota-2.6.11.60ec05e.zip ros-firmware-rak4631-2.6.4.b89355f.uf2 ros-firmware-rak4631-ota-2.6.4.b89355f.zip ros-firmware-rak4631-2.5.21.447533a.uf2 nrf_erase2.uf2 Kodändringar Nedan är de ändringar jag gör på firmwaren för att det ska passa mig.
Channels.cpp - channelSettings.module_settings.position_precision = 13; // default to sending location on the primary channel + channelSettings.module_settings.position_precision = 32; // default to sending location on the primary channel NeighborInfoModule.cpp Tillåt sändning av Neighbor info över default kanalen."><meta itemprop=dateModified content="2025-07-14T10:58:29+02:00"><meta itemprop=wordCount content="365"><meta name=twitter:card content="summary"><meta name=twitter:title content="Custom Firmware"><meta name=twitter:description content="Binärer Varning Att ladda ner firmware från internet medför alltid en risk. Istället bör du själv genomföra kodändringarna nedan och kompilera firmware själv. ros-firmware-rak4631-2.6.11.60ec05e.uf2 ros-firmware-rak4631-ota-2.6.11.60ec05e.zip ros-firmware-rak4631-2.6.4.b89355f.uf2 ros-firmware-rak4631-ota-2.6.4.b89355f.zip ros-firmware-rak4631-2.5.21.447533a.uf2 nrf_erase2.uf2 Kodändringar Nedan är de ändringar jag gör på firmwaren för att det ska passa mig.
Channels.cpp - channelSettings.module_settings.position_precision = 13; // default to sending location on the primary channel + channelSettings.module_settings.position_precision = 32; // default to sending location on the primary channel NeighborInfoModule.cpp Tillåt sändning av Neighbor info över default kanalen."><link rel=preload href=/scss/main.min.a1a53110da3326fb58458c74bf11af462600d3299a1dc06c2ecc38c70a8c50a8.css as=style integrity="sha256-oaUxENozJvtYRYx0vxGvRiYA0ymaHcBsLsw4xwqMUKg=" crossorigin=anonymous><link href=/scss/main.min.a1a53110da3326fb58458c74bf11af462600d3299a1dc06c2ecc38c70a8c50a8.css rel=stylesheet integrity="sha256-oaUxENozJvtYRYx0vxGvRiYA0ymaHcBsLsw4xwqMUKg=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-4LJP3Y6HMZ"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-4LJP3Y6HMZ")}</script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" data-name="Layer 1" viewBox="0 0 999.988833921388505 965.773921479686578"><defs><style>.cls-1{fill:#2c2d3c}.cls-1,.cls-2,.cls-3{stroke-width:0}.cls-2{fill:#67ea94}.cls-3{fill:#fff}</style></defs><g><path class="cls-2" d="m94.0257162280341.0H906.43282950695c51.634964467955.0 93.556004414437 41.9210399464821 93.556004414437 93.5560044144368V586.434207041572H.469711813595495V93.556004414438C.469711813595495 41.921039946482935 42.39075176007843.0 94.025716228034071.0z"/><path class="cls-1" d="m0 586.434207041572H999.988833921389V872.15696831267c0 51.668603000227677-41.948350166788941 93.616953167016618-93.616953167016618 93.616953167016618H93.6169531670164C41.9483501667886 965.773921479687.0 923.825571312898.0 872.156968312671V586.434207041572h0z"/><g><path class="cls-1" d="m612.627557131533 191.742232293423c-7.47519668721395 10.6314112494-14.3721386434299 20.395662282181-21.223486733903 30.191665191416-62.685614390861 89.627311866914-125.363355142257 179.260182599808-188.044849605491 268.890376841673-.572578386265036.818731742230966-1.13636759359304 1.645973353366-1.75206788902699 2.43185517154598C397.782303647751 498.137911874573 397.283426189044 498.283631941576 391.906554419455 494.723761620285c-12.703476400373-8.41072435705502-25.365936632367-16.883762915444-38.013473570955-25.378533665931-7.79142402110603-5.23315760872401-7.90586645520102-5.83520795776002-2.574863213198-13.447422949227 31.944179298115-45.613766618462 63.901267702795-91.218611600166 95.865405761417-136.818400987711 43.144339884211-61.549639942648 86.279249711853-123.106028302842 129.483465877583-184.613667924767 3.86000597111592-5.49531647337599 7.38144544520401-11.225946835169 12.2411289666289-16.038689468794 13.256736903763-13.128760385124 37.2837886111611-12.535711738813 48.961036816514 3.28860681194699 10.0843010766949 13.665694223843 19.83342315241 27.561143470125 29.651210688582 41.407866854129 68.896359512241 97.169114555992 137.698601566685 194.405004131697 206.528035143467 291.621517742453 7.83225708159102 11.062600816578 7.13772883755303 9.79202248668099-3.15678010208694 16.928599859136-11.699221152699 8.11049984224502-23.5560066486611 15.994024095038-35.3498945828451 23.968000018937-7.23495912956003 4.891573300956-7.32898503341301 4.94702470478802-12.232248233742-2.06030331467701-17.7531343623959-25.370984588677-35.448040414325-50.782688442544-53.152193414929-76.187895514775-50.826906262006-72.936119049432-101.646213546388-145.877568204927-152.478155275494-218.810210103625-1.42256523277899-2.04108748166502-2.95398810886991-4.00640967888501-5.05167214886399-6.840996683957z"/><path class="cls-1" d="m365.748309927359 101.579679411173c7.87116750918398 5.452103725092 15.4218962029 10.686233563461 22.97692793214 15.914186884075 7.19046391118303 4.97563113238401 14.412239272338 9.90645963506201 21.5691028848721 14.929775772103C415.364781452425 135.98255159699 415.366520977424 136.112372849774 411.864948709896 141.127430753819c-17.0185970434 24.374437763116-34.044976172317 48.743453916205-51.086461702536 73.101924237129-41.672335519903 59.565239168368-83.360509872685 119.119520736721-125.030419212986 178.686589984421-23.197939160864 33.161632315252-46.3716165257 66.340238616329-69.557333234603 99.510426552468-.429388012724985.61431188057702-.855525860322985 1.232055159906-1.312013841442 1.82605315987104-3.284177419722 4.27337250179397-3.36080807359198 4.38148443847297-7.68128462253299 1.46950795354701-13.247261070221-8.92863680869203-26.478362868748-17.882986232033-39.620108014732-26.965532712747-5.65972768969999-3.91147431341301-5.67002750876699-4.55451843954-1.435337008424-10.611532012629 37.359549502533-53.436577989337 74.739332427414-106.859064367799 112.116506064798-160.283312197618 41.672930620561-59.564209748742 83.346547895726-119.127847597691 125.028588134041-178.685674944754 3.99706223018802-5.711277272833 8.05619803662904-11.379296045398 12.46122465588-17.596201362334z"/></g></g><g><path class="cls-3" d="m164.27447803006 662.085263727679c28.94261912454931.0 51.162523431675254 5.242074734207563 66.664111644267905 15.720305412933158C246.436267911018 688.28873214408 254.187306390809 705.451249311139 254.187306390809 729.292134176839c0 24.040150785214792-7.842922913499933 41.392069222309146-23.5287687404998 52.063647030863649C214.973180570297 792.028345481204 192.564619925874 797.364134385481 163.434321958003 797.364134385481H151.478692710196c-.977192568570899.0-1.769363664070625.792171095499725-1.769363664070625 1.769363664070625V862.513593405724c0 .977192568570899-.792171095499725 1.769363664070625-1.769363664070625 1.769363664070625H107.782757011401c-.977192569474028.0-1.769363666570825-.792171094595687-1.769363669655831-1.769363664070625l-.61162882e-6-193.774661418201504c-.2676643e-8-.848080234489316.595750075995966-1.581889722359847 1.428225267588459-1.743831500521992C116.543662976084 665.224475531938 126.150974064212 663.97145689927 136.264388158266 663.239427716958c10.64393190068-.766483264675003 19.978999367985-1.15416398927891 28.010089871794-1.15416398927891zM167.07548701724 700.448885559318c-3.177344167797855.0-6.302392407900697.098646494810964-9.383453419099169.288047764846851-2.368062989260579.148604062223967-4.48783070708123.297790854696359-6.359497804256534.444872784206382-.920898959858874.0723673542729557-1.62322275133985.835521770910987-1.62322131560586 1.75925979017302C149.709327351644 711.223671305456 149.709328849029 748.645268297641 149.7093290232 757.238709168519c.19806066e-7.977192567441307.792171119554951 1.762789850270565 1.769363686996257 1.762789850270565H163.434321958003c15.125253031973443.0 26.513546595097978-2.113007918831499 34.172211894190696-6.344942546184029C205.261289175384 748.428567705046 209.091110571919 740.54178044498 209.091110571919 729.004086411992c0-5.575499886665057-.980426457561407-10.190182913880562-2.941279372682402-13.845035546593863-1.96085291512259-3.65090677292017-4.76186190230158-6.5846535285732-8.40302696153859-8.79729440716221C194.10563917846 704.153061439437 189.667327782095 702.611216725555 184.442133735342 701.746086966071 179.212052218712 700.880957206587 173.421866654044 700.448885559318 167.07548701724 700.448885559318z"/><path class="cls-3" d="m414.675236739396 684.474000037414c.790190886738856-.353369614e-6 1.476387725881978.514648521850177 1.693246840866777 1.274499666307747C418.531138799533 693.326212282432 420.904158381171 701.806876435902 423.490882245157 711.192122305792c2.73271845934795 9.91988798505292 5.65110770668298 20.173665846521 8.75961198958697 30.762321424275 3.10406003532 10.591619097366 6.26145104165801 21.1842260346019 9.46279071855599 31.771893772484 3.20232901095602 10.592612638128 6.30935349889199 20.4137215065319 9.32551444569702 29.4623347996729 2.463098035896-9.820121955932 4.975579896238-20.5075637482249 7.53546708565096-32.0613415003969 2.55593616653101-11.5537751317661 4.97360685264704-23.490832133499 7.247086394902-35.817098044423 2.27347954225405-12.3203388716991 4.501528998087-24.5962249492001 6.68217314634904-36.826670392633 2.08492939796696-11.7004362766891 4.04142648325995-23.0037255421121 5.86947109325598-33.914134852124.142781544839011-.852170175491096.876803121843977-1.4693199415251 1.74085206579002-1.46931812995706 6.734640079852397.14119870684e-4 34.269632443581941.1593572415e-4 42.210650891058322.16164553017e-4 1.117170852177878.32192474e-7 1.95093281847403 1.01983260081397 1.73253988866054 2.115448975810068-6.54222416887387 32.820512708262-14.0440328521019 66.103868322305-22.4980108400959 99.8454316306739-8.52210751355597 34.018356493123-17.738639769166 66.344501463848-27.642004319001 96.983179779202C473.680539518969 862.775815732673 472.999236664115 863.26809548121 472.230336505025 863.268095485483l-37.839887572029511.210273356e-6c-.749813418205122.4167305e-8-1.418100664081976-.467839669854584-1.669246982354707-1.174342103635354C426.275272284124 843.960638885595 420.011963487076 824.954656800671 413.930811885024 805.06654525139c-6.217503348788-20.31394230254-12.337233219962-40.677276614169-18.359681075787-61.0909890761101-6.04516259786197 20.413714721828-12.089833733539 40.7770479007701-18.134504869218 61.0909890761101-5.91686994389499 19.888315669543-12.104852135209 38.894483767285-18.563947379635 57.0277666848019C358.62115226108 862.800447605955 357.952698609457 863.268095692662 357.203103343096 863.268095688495l-37.80840252566486-.210160579e-6c-.769057547278862-.4274625e-8-1.450478963975002-.492482006231512-1.686848276519413-1.22431467775823C307.812127450084 831.405222639395 298.613662924788 799.079212698748 290.109136120384 765.061006153727c-8.44144719360901-33.7417152803321-15.92503751196-67.025218738797-22.459107704019-99.845875107103-.218094141861002-1.095487601993.622743548748019-2.11500562542199 1.739729735249-2.11500579668405L313.5607622356 663.10011847744C314.424610735426 663.10011834499 315.159798925488 663.716936813981 315.30248878452 664.568919111204c1.8273047118397 10.9105950252803 3.8322125836487 22.2140399648742 6.01168484970071 33.9146432535673 2.272985736968 12.2304454434329 4.64325111551403 24.5063315209339 7.11030233035001 36.826670392633 2.46310077253798 12.326265910924 4.97459446322199 24.2633229126569 7.53497487733898 35.817098044423 2.56038342827304 11.5537887332199 5.16915988863104 22.241239859777 7.82238111110803 32.061329133423 3.40034056281797-9.43290819116908 6.707843795494-19.4476160891351 9.92251188431396-30.039220917389 3.21072197735504-10.588655577753 6.33255900301504-21.180274675121 9.35711638709603-31.7728816123571 3.02455738408099-10.588655577752 5.81011300915998-20.796992805153 8.36160492810598-30.6180968031019 2.40889729617203-9.27130165909 4.60872180020601-17.597815147441 6.59613962428705-24.9828238239841.207911912846953-.772575983630986.900264149766997-1.30163263875693 1.70032728101796-1.3016316458619 5.86792097032685.7282225852e-5 29.128584213464819-.2489283361e-5 34.955704681557108-.5095142114e-5z"/><path class="cls-3" d="m607.528599056966 661.66055765223c28.873984022540753.0 50.989938497172261 5.3591946252036 66.355614568898091 16.076593266623604C689.245045231963 688.453558951284 696.927398821264 705.10866786691 696.927398821264 727.701487056748c0 14.09834711754047-3.101426893601456 25.539880929203719-9.300405108298946 34.324601434989745-5.836671230241 8.26855561821026-14.0840716668911 14.8667555740273-24.750279842273 19.7986901668653-1.03541392706404.478763744416938-1.37351504734204 1.77433311596303-.685021071704 2.68387847977795C665.665765698986 789.098133606668 669.283739512661 794.251135840713 673.050965538238 799.970375168966c4.25537860565009 6.47164851875095 8.46812591379398 13.228592426056 12.6324285656821 20.275784766851 4.16430265188501 7.05115477674497 8.19005358687798 14.387604942041 12.077252804971 22.0133129318421C701.206544208937 849.023848136819 704.43392269572 855.670676751358 707.4427801196 862.203407936569 707.98251162741 863.375255038639 707.117191274534 864.707664305896 705.827022397543 864.70766483287L661.228913003659 864.707683049142c-.65123315400524.265998096e-6-1.247822331100906-.35378787836089-1.556385652542303-.927280073196016-3.36963756461478-6.26276912531898-6.78220582353572-12.615589903521-10.2334872727407-19.059266773051C645.816348683447 837.964192295592 642.102581334755 831.39744531399 638.293862459796 825.024857694039c-3.80871887495789-6.371597010963-7.57383755928299-12.405396357012-11.287604907977-18.103379256118-3.54038192103701-5.42158039351102-7.08076384207595-10.367011634882-10.617798535832-14.8294471213339C616.051841074239 791.667343413107 615.540963298341 791.425381225808 614.99904867954 791.425381246711l-18.750138567998874.723312041e-6C595.271717531929 791.42538200772 594.47954644747 792.217553122738 594.47954644747 793.19474570235v69.743553778824c0 .977192568570899-.792171095499725 1.769363664070625-1.769363664070625 1.769363664070625H552.937449631167c-.977192569260296.0-1.769363665978744-.792171094810328-1.769363668332517-1.769363664070625L551.168085494152 668.331559345565c-.2037268e-8-.846072174810615.595620234627859-1.578916771546574 1.425657187537581-1.742858168970997C561.589894230288 664.811862626036 570.875721651655 663.554354838022 580.45869403345 662.819570168217c10.086177432793-.769703183693991 19.1094791072979-1.159012515987 27.069905023516-1.159012515987zm2.49877536975509 38.5247835442078c-3.149871549854652.0-5.969350544035478.099060898801326-8.468125913794211.289257824502783-1.90062311537622.147681850594381-3.721087747204365.295936813639855-5.460951998249584.442148810394428-.915994371074248.0769769054879816-1.61876167970422.843777894661002-1.61876148110321 1.76300100784999L594.479546065193 753.739508295465c.211126462e-6.977192630407444.792171415940174 1.769363664070625 1.769364046347619 1.769363664070625H606.695350969339c16.285155647488864.0 27.945784408648251-2.122875061331797 34.982855176598605-6.372587619949627 7.03125740920041-4.24575012266507 10.5502772397405-11.4871018251121 10.5502772397405-21.724055107342.0-9.848634558920821-3.56649559366997-16.84530584132699-10.689797849759998-20.999919937094091C634.411507707328 702.26264824432 623.908706230721 700.185341196438 610.027374426722 700.185341196438z"/><path class="cls-3" d="m904.686169638722 762.897338045418c0 17.229911529557285-2.6142578125 32.260907651299931-7.8349609375 45.084149491325661-5.224609375 12.828152325528208-12.640625 23.453460854841978-22.2470703125 31.874943490840451-9.6103515625 8.427375218599991-21.3154296875 14.74422376842449-35.119140625 18.953491940772437-13.8076171875 4.208286075247088-29.291015625 6.317830646923539-46.4521484375 6.317830646923539-7.8359375.0-16.978515625-.336859305440157-27.423828125-1.005667430817994-9.959457433588-.64114501907909-19.7441762822961-1.92633201017611-29.3617640442531-3.87171594805511C735.420531164215 860.08314540757 734.826794403934 859.350824121911 734.82679440121 858.507355088409L734.826793784672 667.600203509247c-.2764864e-8-.855578740234705.607839606553171-1.593802597864851 1.449427480316444-1.747896178127121C745.906529391705 664.089011180427 755.91748400978 662.886672126199 766.308239951222 662.246134613014c10.9140625-.668808125377836 20.2880859375-1.005667430817994 28.123046875-1.005667430817994 16.6025390625.0 31.6650390625 1.916071442896282 45.193359375 5.743303843184549 13.5244140625 3.832142885792564 25.1376953125 9.863201179397947 34.83984375 18.092192783715291 9.6982421875 8.232919992718962 17.162109375 18.763947200393886 22.38671875 31.587189040419617 5.220703125 12.828152325528208 7.8349609375 28.241184219330535 7.8349609375 46.234185195902683zM778.481073650971 824.445080819171c-.130197805e-6.927374602013515.708392441789329 1.69584649708122 1.633118525604004 1.765884503727648 1.652371576437872.125149288509419 3.486727478686589.222637311899234 5.502641524646606.292873527538177 2.7021484375.098209710042283 5.919921875.143386176659988 9.654296875.143386176659988 21.8271484375.0 38.009765625-5.644112036043225 48.5517578125-16.94215707913645 10.537109375-11.294116654691607 15.810546875-26.894729094670765 15.810546875-46.807729902542633.0-20.864652898164422-5.037109375-36.65873846692557-15.111328125-47.382256706279804-10.07421875-10.719589850952616-26.0244140625-16.080857922079304-47.8515625-16.080857922079304-2.986328125.0-6.064453125.049104855021142-9.234375.143386176659988-2.59596381045958.080303791317419-5.063301399612101.25384838779064-7.406283109918149.523318881128944-.886749977556519.101986691945172-1.5487955419735.864579893781183-1.54879566728857 1.7571754393872L778.481073650972 824.445080819171z"/></g></svg></span><span class=navbar-brand__name>STHLM-MESH</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/about/><span>Om</span></a></li><li class=nav-item><a class=nav-link href=/meetups/><span>Meetups</span></a></li><li class=nav-item><a class=nav-link href=/messages/><span>Meddelanden</span></a></li><li class=nav-item><a class=nav-link href=/status/><span>Status</span></a></li><li class=nav-item><a class="nav-link active" href=/docs/><span>Docs</span></a></li><li class=nav-item><a class=nav-link href="https://map.sthlm-mesh.se/?lat=59.34338409949693&amp;lng=378.0628967285156&amp;zoom=10" target=_blank rel=noopener><span>Map</span></a></li></ul></div><div class="d-none d-lg-block"></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="td-sidebar-nav collapse td-sidebar-nav--search-disabled" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docs-li><a href=/docs/ title=Documentation class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-docs><span>Docs</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docssettings-li><a href=/docs/settings/ title="Rekommenderade Inställningar" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docssettings><span>Inställningar</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsdevice_role-li><a href=/docs/device_role/ title="Enhetsroller i Meshtastic" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdevice_role><span>Enhetsroll</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsposition-li><a href=/docs/position/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsposition><span>Position</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsmqtt-li><a href=/docs/mqtt/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsmqtt><span>MQTT</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsneighbor_info-li><a href=/docs/neighbor_info/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsneighbor_info><span>Neighbor Info</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskartor-li><a href=/docs/kartor/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docskartor><span>Kartor</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docshardware-li><a href=/docs/hardware/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docshardware><span>Hårdvara</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docssolar_nodes-li><a href=/docs/solar_nodes/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docssolar_nodes><span>Solnoder</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscommunities-li><a href=/docs/communities/ title="Communities i Sverige" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscommunities><span>Communities</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"><a href=https://github.com/Roslund/sthlm-mesh/tree/main/content/sv/docs/firmware/_index.md class="td-page-meta--view td-page-meta__view" target=_blank rel=noopener><i class="fa-solid fa-file-lines fa-fw"></i> Visa sidans källa</a>
<a href=https://github.com/Roslund/sthlm-mesh/edit/main/content/sv/docs/firmware/_index.md class="td-page-meta--edit td-page-meta__edit" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Redigera sida</a>
<a href="https://github.com/Roslund/sthlm-mesh/new/main/content/sv/docs/firmware?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class="td-page-meta--child td-page-meta__child" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Skapa barnsida</a>
<a href="https://github.com/Roslund/sthlm-mesh/issues/new?title=Custom%20Firmware" class="td-page-meta--issue td-page-meta__issue" target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Skapa dokumentationsfråga</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#binärer>Binärer</a></li><li><a href=#kodändringar>Kodändringar</a><ul><li><a href=#channelscpp>Channels.cpp</a></li><li><a href=#neighborinfomodulecpp>NeighborInfoModule.cpp</a></li><li><a href=#mqtth>MQTT.h</a></li><li><a href=#mqttc>MQTT.c</a></li></ul></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=/docs/>Docs</a></li><li class="breadcrumb-item active" aria-current=page>Custom Firmware</li></ol></nav><div class=td-content><h1>Custom Firmware</h1><header class=article-meta></header><h2 id=binärer>Binärer<a class=td-heading-self-link href=#bin%c3%a4rer aria-label="Heading self-link"></a></h2><div class="alert alert-danger" role=alert><h4 class=alert-heading>Varning</h4>Att ladda ner firmware från internet medför alltid en risk. Istället bör du själv genomföra kodändringarna nedan och kompilera firmware själv.</div><ul><li><a href=/firmware/ros-firmware-rak4631-2.6.11.60ec05e.uf2>ros-firmware-rak4631-2.6.11.60ec05e.uf2</a></li><li><a href=/firmware/ros-firmware-rak4631-ota-2.6.11.60ec05e.zip>ros-firmware-rak4631-ota-2.6.11.60ec05e.zip</a></li><li><a href=/firmware/ros-firmware-rak4631-2.6.4.b89355f.uf2>ros-firmware-rak4631-2.6.4.b89355f.uf2</a></li><li><a href=/firmware/ros-firmware-rak4631-ota-2.6.4.b89355f.zip>ros-firmware-rak4631-ota-2.6.4.b89355f.zip</a></li><li><a href=/firmware/ros-firmware-rak4631-2.5.21.447533a.uf2>ros-firmware-rak4631-2.5.21.447533a.uf2</a></li><li><a href=/firmware/nrf_erase2.uf2>nrf_erase2.uf2</a></li></ul><h2 id=kodändringar>Kodändringar<a class=td-heading-self-link href=#kod%c3%a4ndringar aria-label="Heading self-link"></a></h2><p>Nedan är de ändringar jag gör på firmwaren för att det ska passa mig.</p><h3 id=channelscpp>Channels.cpp<a class=td-heading-self-link href=#channelscpp aria-label="Heading self-link"></a></h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span><span style=color:#a40000>-    channelSettings.module_settings.position_precision = 13; // default to sending location on the primary channel
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#00a000>+    channelSettings.module_settings.position_precision = 32; // default to sending location on the primary channel
</span></span></span></code></pre></div><h3 id=neighborinfomodulecpp>NeighborInfoModule.cpp<a class=td-heading-self-link href=#neighborinfomodulecpp aria-label="Heading self-link"></a></h3><p>Tillåt sändning av Neighbor info över default kanalen.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span>int32_t NeighborInfoModule::runOnce()
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    if (moduleConfig.neighbor_info.transmit_over_lora &amp;&amp;
</span></span><span style=display:flex><span><span style=color:#a40000>-       (!channels.isDefaultChannel(channels.getPrimaryIndex()) || !RadioInterface::uses_default_frequency_slot) &amp;&amp;
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>        airTime-&gt;isTxAllowedChannelUtil(true) &amp;&amp; airTime-&gt;isTxAllowedAirUtil()) {
</span></span><span style=display:flex><span>        sendNeighborInfo(NODENUM_BROADCAST, false);
</span></span><span style=display:flex><span>    } else {
</span></span><span style=display:flex><span>        sendNeighborInfo(NODENUM_BROADCAST_NO_LORA, false);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    return Default::getConfiguredOrDefaultMs(moduleConfig.neighbor_info.update_interval, default_neighbor_info_broadcast_secs);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Behåll noder längre i neighbor info databasen.
Då noder inte sänder nodinfo om channel utilization är för hög så vill vi låta dom vara kvar lite längre.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span>void NeighborInfoModule::cleanUpNeighbors()
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    uint32_t now = getTime();
</span></span><span style=display:flex><span>    NodeNum my_node_id = nodeDB-&gt;getNodeNum();
</span></span><span style=display:flex><span>    for (auto it = neighbors.rbegin(); it != neighbors.rend();) {
</span></span><span style=display:flex><span>        // We will remove a neighbor if we haven&#39;t heard from them in twice the broadcast interval
</span></span><span style=display:flex><span>        // cannot use isWithinTimespanMs() as it-&gt;last_rx_time is seconds since 1970
</span></span><span style=display:flex><span><span style=color:#a40000>-        if ((now - it-&gt;last_rx_time &gt; it-&gt;node_broadcast_interval_secs * 2) &amp;&amp; (it-&gt;node_id != my_node_id)) {
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#00a000>+        if ((now - it-&gt;last_rx_time &gt; it-&gt;node_broadcast_interval_secs * 4) &amp;&amp; (it-&gt;node_id != my_node_id)) {
</span></span></span><span style=display:flex><span><span style=color:#00a000></span>            LOG_DEBUG(&#34;Remove neighbor with node ID 0x%x&#34;, it-&gt;node_id);
</span></span><span style=display:flex><span>            it = std::vector&lt;meshtastic_Neighbor&gt;::reverse_iterator(
</span></span><span style=display:flex><span>                neighbors.erase(std::next(it).base())); // Erase the element and update the iterator
</span></span><span style=display:flex><span>        } else {
</span></span><span style=display:flex><span>            ++it;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=mqtth>MQTT.h<a class=td-heading-self-link href=#mqtth aria-label="Heading self-link"></a></h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span><span style=color:#a40000>-    const uint32_t default_map_position_precision = 14;         // defaults to max. offset of ~1459m
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#00a000>+    const uint32_t default_map_position_precision = 32;         // defaults to max. offset of ~1459m
</span></span></span></code></pre></div><h3 id=mqttc>MQTT.c<a class=td-heading-self-link href=#mqttc aria-label="Heading self-link"></a></h3><p>Respektera <strong>inte</strong> OK_TO_MQTT flaggan</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span><span style=color:#a40000>- // For uplinking other&#39;s packets, check if it&#39;s not OK to MQTT or if it&#39;s an older packet without the bitfield
</span></span></span><span style=display:flex><span><span style=color:#a40000>- bool dontUplink = !mp_decoded.decoded.has_bitfield || !(mp_decoded.decoded.bitfield &amp; BITFIELD_OK_TO_MQTT_MASK);
</span></span></span><span style=display:flex><span><span style=color:#a40000>- // check for the lowest bit of the data bitfield set false, and the use of one of the default keys.
</span></span></span><span style=display:flex><span><span style=color:#a40000>- if (!isFromUs(&amp;mp_decoded) &amp;&amp; !isMqttServerAddressPrivate &amp;&amp; dontUplink &amp;&amp;
</span></span></span><span style=display:flex><span><span style=color:#a40000>-     (ch.settings.psk.size &lt; 2 || (ch.settings.psk.size == 16 &amp;&amp; memcmp(ch.settings.psk.bytes, defaultpsk, 16)) ||
</span></span></span><span style=display:flex><span><span style=color:#a40000>-         (ch.settings.psk.size == 32 &amp;&amp; memcmp(ch.settings.psk.bytes, eventpsk, 32)))) {
</span></span></span><span style=display:flex><span><span style=color:#a40000>-     LOG_INFO(&#34;MQTT onSend - Not forwarding packet due to DontMqttMeBro flag&#34;);
</span></span></span><span style=display:flex><span><span style=color:#a40000>-     return;
</span></span></span><span style=display:flex><span><span style=color:#a40000>- }
</span></span></span></code></pre></div><div class=section-index></div><div class=td-page-meta__lastmod>Senast ändrad July 14, 2025</div></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2025&ndash;2025
<span class=td-footer__authors>STHLM-MESH Authors | <a href=https://creativecommons.org/licenses/by/4.0>CC BY 4.0</a> |</span></span><span class=td-footer__all_rights_reserved>Alla rättigheter förbehållna</span><span class=ms-2><a href=https://policies.google.com/privacy target=_blank rel=noopener>Integritetspolicy</a></span></div></div></div></footer></div><script src=/js/main.min.7759f7107045cd01303fdfbe5620c99ad1a8a8a09e0938b93e036ca546ea64ec.js integrity="sha256-d1n3EHBFzQEwP9++ViDJmtGoqKCeCTi5PgNspUbqZOw=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>